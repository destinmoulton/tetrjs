/**
 * tetrjs - Tetris in JavaScript.
 * @author Destin Moulton
 * @version v1.0.0
 * @link https://github.com/destinmoulton/tetrjs
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Tetrjs",e):(t=t||self).Tetrjs=e()}(this,function(){"use strict";function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){return!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}var i={hasClass:r,addClass:function(t,e){r(t,e)||(t.className+=" "+e)},removeClass:function(t,e){if(r(t,e)){var n=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(n," ")}},fadeIn:function(t,e){var n=.1;t.style.display="block";var r=setInterval(function(){if(.5<=n)return clearInterval(r),e();t.style.opacity=n,t.style.filter="alpha(opacity="+100*n+")",n+=.1*n},10)},fadeOut:function(t,e){var n=1,r=setInterval(function(){if(n<=.1)return clearInterval(r),t.style.display="none",e();t.style.opacity=n,t.style.filter="alpha(opacity="+100*n+")",n-=.1*n},10)},outerHeight:outerHeight,outerWidth:outerWidth},a=["STRAIGHT","L_LEFT","L_RIGHT","SQUARE","S","Z","T"],I={STRAIGHT:{class:"tetrjs-block-straight",no_positions:2,positions:[{trans_row:1,trans_col:-1,rows:[[1,1,1,1]]},{trans_row:-1,trans_col:1,rows:[[1],[1],[1],[1]]}]},L_LEFT:{class:"tetrjs-block-l-left",no_positions:4,positions:[{trans_row:1,trans_col:-1,rows:[[1,1,1],[0,0,1]]},{trans_row:-1,trans_col:0,rows:[[0,1],[0,1],[1,1]]},{trans_row:0,trans_col:0,rows:[[1,0,0],[1,1,1]]},{trans_row:0,trans_col:1,rows:[[1,1],[1,0],[1,0]]}]},L_RIGHT:{class:"tetrjs-block-l-right",no_positions:4,positions:[{trans_row:1,trans_col:-1,rows:[[1,1,1],[1,0,0]]},{trans_row:-1,trans_col:0,rows:[[1,1],[0,1],[0,1]]},{trans_row:0,trans_col:0,rows:[[0,0,1],[1,1,1]]},{trans_row:0,trans_col:1,rows:[[1,0],[1,0],[1,1]]}]},SQUARE:{class:"tetrjs-block-square",no_positions:1,positions:[{trans_row:0,trans_col:0,rows:[[1,1],[1,1]]}]},S:{class:"tetrjs-block-s",no_positions:2,positions:[{trans_row:1,trans_col:0,rows:[[0,1,1],[1,1,0]]},{trans_row:-1,trans_col:0,rows:[[1,0],[1,1],[0,1]]}]},Z:{class:"tetrjs-block-z",no_positions:2,positions:[{trans_row:1,trans_col:0,rows:[[1,1,0],[0,1,1]]},{trans_row:-1,trans_col:0,rows:[[0,1],[1,1],[1,0]]}]},T:{class:"tetrjs-block-t",no_positions:4,positions:[{trans_row:1,trans_col:-1,rows:[[1,1,1],[0,1,0]]},{trans_row:-1,trans_col:0,rows:[[0,1],[1,1],[0,1]]},{trans_row:0,trans_col:0,rows:[[0,1,0],[1,1,1]]},{trans_row:0,trans_col:1,rows:[[1,0],[1,1],[1,0]]}]}},E=10,P=18,c=4,l=1,u=1,d=460,h=100,v=20,m=20,p={about:function(){return'\n    Tetrjs is a Tetris clone written in JavaScript.\n    <br />\n    <br />\n    Tetrjs was written by\n    <a href="https://destinmoulton.com" target="_blank">Destin Moulton</a>.\n    <br />\n    <br />\n    Available on\n    <a href="https://github.com/destinmoulton/tetrjs" target="_blank">GitHub</a>.\n    <br />\n    Open source under the\n    <a href="https://en.wikipedia.org/wiki/MIT_License">MIT License</a>.\n    <br />\n    <br />\n    <button type="button" id="tetrjs-about-close">Resume Game</button>\n'},container:function(){return'\n    \x3c!-- The Game Container --\x3e\n    <div id="tetrjs-container">\n        <div id="tetrjs-title-container">Tetrjs</div>\n        <div id="tetrjs-board-wrapper"><div id="tetrjs-board"></div></div>\n        <div id="tetrjs-next-piece-preview-container"></div>\n        <div id="tetrjs-score-container"></div>\n        <div id="tetrjs-level-container"></div>\n        <div id="tetrjs-actions-container">\n            <br />\n            <button id="tetrjs-button-pause">\n                <div class="icon">&#9613;&#9613;</div>\n                <div class="button-text">Pause</div>\n            </button>\n            <br />\n            <br />\n            <button id="tetrjs-button-new">New Game</button>\n            <br />\n            <br />\n            <button id="tetrjs-button-about">\n                About Tetrjs\n            </button>\n        </div>\n        <div id="tetrjs-modal-veil"></div>\n        <div id="tetrjs-modal"></div>\n    </div>\n'},gameover:function(t){var e=t.score,n=t.rowsEliminated,r=t.level;return'\n    Game Over! <br /><br />\n    <table border="0" id="tetrjs-gameover-table">\n        <tbody>\n            <tr>\n                <td><strong>Score:</strong></td>\n                <td>'.concat(e,"</td>\n            </tr>\n            <tr>\n                <td><strong>Lines:</strong></td>\n                <td>").concat(n,"</td>\n            </tr>\n            <tr>\n                <td><strong>Level:</strong></td>\n                <td>").concat(r,'</td>\n            </tr>\n        </tbody>\n    </table>\n    <br />\n    <button id="tetrjs-gameover-newgame">New Game</button>\n')},intro:function(){return'\n    <button type="button" id="tetrjs-intro-newgame">\n        <span>▶</span>&nbsp;&nbsp;Play Tetrjs!\n    </button>\n\n    <br /><br />\n    Arrow keys control the pieces.\n    <br />\n    &nbsp;\n\n    <div id="tetrjs-arrows-container">\n        <div id="up">⬆</div>\n        <br />\n        <div id="left">⬅</div>\n        <div id="down">⬇</div>\n        <div id="right">➡</div>\n    </div>\n'},paused:function(){return'\n    Paused...\n    <br />\n    <br />\n    <button type="button" id="tetrjs-pause-play">\n        <span class="">▶</span>&nbsp;&nbsp;Resume\n    </button>\n    <br />\n    <br />Tip: Press <b>P</b> key to pause/resume.\n'}};return function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o(this,"board",[]),o(this,"isPaused",!1),o(this,"DOM_IDS",{BOARD_WRAPPER:"tetrjs-board-wrapper",BOARD:"tetrjs-board",PREVIEW_CONTAINER:"tetrjs-next-piece-preview-container",SCORE_CONTAINER:"tetrjs-score-container",LEVEL_CONTAINER:"tetrjs-level-container",MODAL:"tetrjs-modal",MODAL_VEIL:"tetrjs-modal-veil"}),o(this,"DOM_CLASSES",{BOARD_BLOCK:"tetrjs-board-block"}),o(this,"currentBlock",{type:"",blockIds:[],blockPositions:[],class:"",row:l,col:c,position:u}),o(this,"previewPiece",{type:"",class:"",blocks:[]}),o(this,"gameIntervalTimer",{obj:!1,ms:d}),o(this,"currentGame",{score:0,rowsEliminated:0,level:1})}var e,n,r;return e=t,(n=[{key:"setupBoard",value:function(){var t=document.getElementById(this.DOM_IDS.BOARD),e=document.getElementById(this.DOM_IDS.BOARD_WRAPPER);t.innerHTML="",this.board={};var n=E*v,r=(P-1)*m;e.style.width="".concat(n,"px"),e.style.height="".concat(r,"px");var s=E*v,o=P*m;t.style.width="".concat(s,"px"),t.style.height="".concat(o,"px");for(var i=0;i<P;i++){this.board[i]=[];for(var a=i*m,c=0;c<E;c++){this.board[i][c]={};var l=c*v,u=document.createElement("div");u.style.left=l.toString()+"px",u.style.top=a.toString()+"px",u.className=this.DOM_CLASSES.BOARD_BLOCK,u.setAttribute("id","tb_".concat(c,"_").concat(i)),t.appendChild(u)}}}},{key:"setupPreviewBoard",value:function(){var t=document.getElementById(this.DOM_IDS.PREVIEW_CONTAINER),e=6*v,n=4*m;t.innerHTML="",t.style.width="".concat(e,"px"),t.style.height="".concat(n,"px");for(var r=0;r<4;r++)for(var s=r*m,o=0;o<6;o++){var i=o*v,a=document.createElement("div");a.style.top=s+"px",a.style.left=i+"px",a.className=this.DOM_CLASSES.BOARD_BLOCK,a.setAttribute("id","tp_".concat(o,"_").concat(r)),t.appendChild(a)}}},{key:"generateRandomBlockType",value:function(){return a[Math.floor(Math.random()*a.length)]}},{key:"makePreviewPiece",value:function(){if(!this.isPaused){var t=!0,e=!1,n=void 0;try{for(var r,s=this.previewPiece.blocks[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var o=r.value;document.getElementById(o).classList.remove(this.previewPiece.class)}}catch(t){e=!0,n=t}finally{try{t||null==s.return||s.return()}finally{if(e)throw n}}this.previewPiece.blocks=[],this.previewPiece.type=this.generateRandomBlockType(),this.previewPiece.class=I[this.previewPiece.type].class;for(var i=I[this.previewPiece.type].positions[0].rows,a=0;a<i.length;a++)for(var c=i[a],l=0;l<c.length;l++)if(1===c[l]){var u="tp_"+(1+l)+"_"+(1+a);document.getElementById(u).classList.add(this.previewPiece.class),this.previewPiece.blocks.push(u)}}}},{key:"moveBlock",value:function(t){var e=this.currentBlock.position,n=I[this.currentBlock.type].positions,r=I[this.currentBlock.type].no_positions,s=0,o=0;"up"==t&&(r-1<(e=this.currentBlock.position+1)&&(e=0),s=n[e].trans_row,o=n[e].trans_col);for(var i=n[e].rows,a=[],c=!1,l=E,u=P,d=!0,h=0;h<i.length;h++)for(var v=i[h],m=0;m<v.length;m++)if(1===v[m]){var p=this.currentBlock.col+m,b=this.currentBlock.row+h,y=p+o,f=b+s;"none"===t&&this.board[f][y].hasOwnProperty("class")&&this.gameOver(),"left"===t&&(y=p-1),"right"===t&&(y=p+1),"down"===t&&(P<(f=b+1)||!this.doesBoardPositionExist(f,y)||this.board[f][y].hasOwnProperty("class"))&&(c=!0),this.doesBoardPositionExist(f,y)&&!this.board[f][y].hasOwnProperty("class")||(d=!1),d&&(y<l&&(l=y),f<u&&(u=f),a.push({col:y,row:f}))}if(d&&!c){this.removeCurrentBlockFromBoard(),"up"==t&&(this.currentBlock.position=e),this.currentBlock.col=l,this.currentBlock.row=u;for(var w=0;w<a.length;w++){var k=a[w],_="tb_".concat(k.col,"_").concat(k.row);document.getElementById(_).classList.add(this.currentBlock.class),this.currentBlock.blockIds.push(_),this.currentBlock.blockPositions.push(k)}}if(c){for(var g=0;g<this.currentBlock.blockPositions.length;g++){var B=this.currentBlock.blockPositions[g];this.board[B.row][B.col]={class:this.currentBlock.class}}this.checkAndEliminateRows(),this.nextBlock()}}},{key:"checkAndEliminateRows",value:function(){for(var t=0,e=0;e<P;e++){for(var n=this.board[e],r=0,s=0;s<n.length;s++)n[s].hasOwnProperty("class")&&r++;if(r===E){t++;for(var o=e;0<=o;o--)for(var i=0;i<E;i++){var a="";this.doesBoardPositionExist(o-1,i)&&this.board[o-1][i].hasOwnProperty("class")&&(a=this.board[o-1][i].class);var c=document.getElementById("tb_".concat(i.toString(),"_").concat(o.toString())),l=this.board[o][i];l.hasOwnProperty("class")&&c.classList.remove(l.class),""!==a?(c.classList.add(a),this.board[o][i]={class:a}):this.board[o][i]={}}}}0<t&&this.score(t)}},{key:"doesBoardPositionExist",value:function(t,e){return this.board[t]&&this.board[t][e]}},{key:"score",value:function(t){var e=0,n=h*this.currentGame.level;this.currentGame.rowsEliminated=this.currentGame.rowsEliminated+t,1<t&&(e=t*(.5*n)),this.currentGame.score=this.currentGame.score+t*n+e,this.setScoreText(),this.currentGame.rowsEliminated==P&&(this.currentGame.rowsEliminated=0,this.currentGame.level=this.currentGame.level+1,this.setLevelText(),this.gameIntervalTimer.ms=this.gameIntervalTimer.ms-20)}},{key:"setScoreText",value:function(){document.getElementById(this.DOM_IDS.SCORE_CONTAINER).innerText=this.currentGame.score}},{key:"setLevelText",value:function(){document.getElementById(this.DOM_IDS.LEVEL_CONTAINER).innerText="LEVEL "+this.currentGame.level}},{key:"removeCurrentBlockFromBoard",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,s=this.currentBlock.blockIds[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var o=r.value;document.getElementById(o).classList.remove(this.currentBlock.class)}}catch(t){e=!0,n=t}finally{try{t||null==s.return||s.return()}finally{if(e)throw n}}this.currentBlock.blockIds=[],this.currentBlock.blockPositions=[]}},{key:"nextBlock",value:function(){this.isPaused||(this.currentBlock.blockIds=[],this.currentBlock.blockPositions=[],this.currentBlock.type=this.previewPiece.type,this.currentBlock.class=I[this.currentBlock.type].class,this.currentBlock.row=1,this.currentBlock.col=c,this.currentBlock.position=0,this.moveBlock("none"),this.killGameInterval(),this.startGameInterval(),this.makePreviewPiece())}},{key:"setupKeyEvents",value:function(){var e=this;document.addEventListener("keydown",function(t){switch(t.keyCode){case 37:e.moveBlock("left");break;case 38:e.moveBlock("up");break;case 39:e.moveBlock("right");break;case 40:e.moveBlock("down");break;case 80:e.pauseGame();break;default:return}t.preventDefault()})}},{key:"startPlay",value:function(){this.isPaused=!1,""==this.previewPiece.type&&(this.previewPiece.type=this.generateRandomBlockType(),this.nextBlock()),this.startGameInterval(),this.hideMessage()}},{key:"startGameInterval",value:function(){var t=this;this.gameIntervalTimer.obj||(this.gameIntervalTimer.obj=setInterval(function(){t.moveBlock("down")},this.gameIntervalTimer.ms))}},{key:"killGameInterval",value:function(){clearInterval(this.gameIntervalTimer.obj),this.gameIntervalTimer.obj=!1}},{key:"pauseGame",value:function(){var e=this;this.isPaused?this.startPlay():(this.killGameInterval(),this.isPaused=!0,this.showMessage("paused"),document.getElementById("tetrjs-pause-play").addEventListener("click",function(t){e.startPlay()}))}},{key:"gameOver",value:function(){var e=this;this.isPaused=!0,this.killGameInterval();var t={score:this.currentGame.score,rowsEliminated:this.currentGame.rowsEliminated,level:this.currentGame.level};this.showMessage("gameover",t),document.getElementById("tetrjs-gameover-newgame").addEventListener("click",function(t){e.newGame()})}},{key:"newGame",value:function(){this.killGameInterval(),this.currentGame.score=0,this.currentGame.level=1,this.gameIntervalTimer.ms=d,this.setScoreText(),this.setLevelText(),this.setupBoard(),this.setupPreviewBoard(),this.previewPiece.type="",this.startPlay()}},{key:"showIntro",value:function(){var e=this;this.setupBoard(),this.setupPreviewBoard(),this.showMessage("intro"),document.getElementById("tetrjs-intro-newgame").addEventListener("click",function(t){e.newGame()})}},{key:"showAbout",value:function(){var e=this;this.killGameInterval(),this.isPaused=!0,this.showMessage("about"),document.getElementById("tetrjs-about-close").addEventListener("click",function(t){e.startPlay()})}},{key:"showMessage",value:function(t,e){var n=document.getElementById(this.DOM_IDS.MODAL),r=document.getElementById(this.DOM_IDS.MODAL_VEIL),s=p[t](e);n.innerHTML=s,i.fadeIn(r,function(){n.style.opacity=0,n.style.display="block";var t=Math.floor((r.offsetWidth-n.offsetWidth)/2),e=Math.floor((r.offsetHeight-n.offsetHeight)/2);n.style.left=t+"px",n.style.top=e+"px",n.style.opacity=1})}},{key:"hideMessage",value:function(){var t=document.getElementById(this.DOM_IDS.MODAL),e=document.getElementById(this.DOM_IDS.MODAL_VEIL);i.fadeOut(t,function(){t.innerHTML=""}),i.fadeOut(e,function(){})}},{key:"run",value:function(t){var e=this;document.getElementById(t).innerHTML=p.container(),document.getElementById("tetrjs-button-pause").addEventListener("click",function(t){e.pauseGame()}),document.getElementById("tetrjs-button-new").addEventListener("click",function(t){e.newGame()}),document.getElementById("tetrjs-button-about").addEventListener("click",function(t){e.showAbout()}),this.setupKeyEvents(),this.showIntro()}}])&&s(e.prototype,n),r&&s(e,r),t}()});